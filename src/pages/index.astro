---
import Layout from '../layouts/Layout.astro';
---


<Layout>
	<main class="app-shell">
		<section class="auth-gate" data-section="login">
			<div>
				<p class="app-eyebrow">Arquivo Inteligente</p>
				<h1>Faça login para acessar o painel do arquivo.</h1>
				<p class="app-subtitle">
					Autenticação obrigatória garante rastreabilidade das movimentações e evita acessos não
					autorizados.
				</p>
			</div>
			<article class="panel auth-panel">
				<div>
					<h2>Acesso seguro</h2>
					<p>Informe usuário e senha para desbloquear as funções.</p>
				</div>
				<form id="login-form" class="stack">
					<label>
						<span>Usuário</span>
						<input type="text" id="login-identifier" placeholder="admin" autocomplete="username" required />
					</label>
					<label>
						<span>Senha</span>
						<input type="password" id="login-password" placeholder="•••••••" required />
					</label>
					<button type="submit">Entrar</button>
					<span id="auth-error" class="form-error" hidden></span>
				</form>
			</article>
		</section>

		<section data-section="app" class="app-content" data-hidden="true">
			<header class="app-header">
				<div>
					<p class="app-eyebrow">Arquivo Inteligente</p>
					<h1>Gerencie pastas, envelopes e movimentações em um só lugar.</h1>
					<p class="app-subtitle">
						Controle o arquivo físico do seu escritório com rastreabilidade, histórico e cadastros
						centralizados.
					</p>
				</div>
				<div class="status-card">
					<strong id="welcome-box">Faça login para começar</strong>
					<span id="auth-info">Sessão não iniciada</span>
					<button id="logout-button" type="button">Encerrar sessão</button>
				</div>
			</header>

			<section class="dashboard" data-guarded>
				<article class="panel summary-panel">
					<header>
						<h2>Visão rápida</h2>
						<p>Indicadores atualizados do arquivo físico.</p>
					</header>
					<div class="cards-grid">
						<div class="summary-card" data-card="total">
							<small>Total de unidades</small>
							<strong>--</strong>
						</div>
						<div class="summary-card" data-card="today">
							<small>Movimentações no dia</small>
							<strong>--</strong>
						</div>
						<div class="summary-card" data-card="units">
							<small>Pastas e envelopes</small>
							<strong>--</strong>
						</div>
						<div class="summary-card" data-card="last">
							<small>Última ação</small>
							<strong>--</strong>
						</div>
					</div>
				</article>
			</section>

			<section class="data-grid" data-guarded>
			<article class="panel">
				<header>
					<div>
						<h2>Unidades de guarda</h2>
						<p>Cadastre pastas, envelopes, gaveteiros e caixas.</p>
					</div>
				</header>
				<form id="storage-form" class="stack inline">
					<label>
						<span>Identificador</span>
						<input name="label" placeholder="Gaveteiro A-01" required />
					</label>
					<label>
						<span>Tipo</span>
						<select name="type">
							<option value="PASTA">Pasta</option>
							<option value="ENVELOPE">Envelope</option>
							<option value="GAVETEIRO">Gaveteiro</option>
							<option value="CAIXA">Caixa</option>
						</select>
					</label>
					<label>
						<span>Seção</span>
						<input name="section" placeholder="Corredor 3" />
					</label>
					<label>
						<span>Capacidade</span>
						<input type="number" min="0" name="capacity" value="0" />
					</label>
					<button type="submit">Cadastrar</button>
				</form>
				<div class="table-wrapper">
					<table>
						<thead>
							<tr>
								<th>Identificador</th>
								<th>Tipo</th>
								<th>Seção</th>
								<th>Ocupação</th>
								<th>Atualizado</th>
							</tr>
						</thead>
						<tbody id="storage-table-body">
							<tr>
								<td colspan="5">Nenhum registro encontrado.</td>
							</tr>
						</tbody>
					</table>
				</div>
			</article>

			<article class="panel">
				<header>
					<div>
						<h2>Movimentações</h2>
						<p>Histórico de retirada, devolução e circulação.</p>
					</div>
				</header>
				<form id="movement-form" class="stack">
					<label>
						<span>Ação realizada</span>
						<input name="action" placeholder="Retirada de pasta" required />
					</label>
					<div class="inline">
						<label>
							<span>Referência</span>
							<input name="reference" placeholder="Proc. 1234/2025" />
						</label>
						<label>
							<span>Item</span>
							<input name="item_label" placeholder="Envelope Financeiro" />
						</label>
					</div>
					<div class="inline">
						<label>
							<span>Origem</span>
							<select name="from_unit" data-storage-select>
								<option value="">—</option>
							</select>
						</label>
						<label>
							<span>Destino</span>
							<select name="to_unit" data-storage-select>
								<option value="">—</option>
							</select>
						</label>
					</div>
					<label>
						<span>Observações</span>
						<textarea name="note" rows="3" placeholder="Detalhe a movimentação"></textarea>
					</label>
					<button type="submit">Registrar movimentação</button>
				</form>
				<ul id="movement-list" class="movement-list">
					<li class="empty">Sem movimentações registradas.</li>
				</ul>
			</article>
			</section>
		</section>
	</main>
	<div id="app-toast" role="status" aria-live="polite"></div>
	</Layout>

<style>
	.app-shell {
		max-width: 1200px;
		margin: 0 auto;
		padding: 2.5rem 1.5rem 4rem;
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.auth-gate {
		max-width: 760px;
		margin: 0 auto;
	}

	.auth-gate {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
		padding: 2rem;
		border-radius: 24px;
		background: rgba(10, 12, 18, 0.85);
		border: 1px solid rgba(255, 255, 255, 0.08);
		box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
	}

	[data-section] {
		transition: opacity 0.3s ease;
	}

	[data-section][data-hidden='true'] {
		opacity: 0;
		display: none;
	}

	.app-header {
		display: flex;
		justify-content: space-between;
		gap: 2rem;
		background: rgba(255, 255, 255, 0.02);
		border: 1px solid rgba(255, 255, 255, 0.06);
		border-radius: 20px;
		padding: 2rem;
		box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
	}

	.app-eyebrow {
		text-transform: uppercase;
		letter-spacing: 0.12em;
		font-size: 0.85rem;
		color: #8fb3ff;
		margin: 0 0 0.75rem;
	}

	.app-header h1 {
		margin: 0;
		font-size: clamp(1.7rem, 3vw, 2.4rem);
	}

	.app-subtitle {
		color: rgba(238, 242, 255, 0.75);
		max-width: 36rem;
	}

	.status-card {
		min-width: 240px;
		background: rgba(15, 17, 23, 0.8);
		border: 1px solid rgba(255, 255, 255, 0.07);
		border-radius: 16px;
		padding: 1.25rem;
		display: flex;
		flex-direction: column;
		gap: 0.4rem;
	}

	.status-card button {
		margin-top: 0.75rem;
		padding: 0.65rem 1rem;
		border-radius: 999px;
		border: none;
		background: rgba(255, 255, 255, 0.1);
		color: inherit;
		cursor: pointer;
		transition: background 0.2s ease;
	}

	.status-card button:hover {
		background: rgba(255, 255, 255, 0.2);
	}

	.dashboard {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
		gap: 1.5rem;
	}

	.panel {
		background: rgba(12, 14, 18, 0.9);
		border-radius: 20px;
		border: 1px solid rgba(255, 255, 255, 0.05);
		padding: 1.5rem;
		box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
	}

	.auth-panel button,
	#storage-form button,
	#movement-form button {
		background: linear-gradient(120deg, #4f46e5, #06b6d4);
		border: none;
		color: #fff;
		padding: 0.75rem 1.25rem;
		border-radius: 12px;
		font-weight: 600;
		cursor: pointer;
	}

	.stack {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.inline {
		display: flex;
		gap: 1rem;
		flex-wrap: wrap;
	}

	label {
		display: flex;
		flex-direction: column;
		gap: 0.4rem;
		font-size: 0.9rem;
		color: rgba(255, 255, 255, 0.8);
	}

	input,
	select,
	textarea {
		border-radius: 12px;
		border: 1px solid rgba(255, 255, 255, 0.12);
		background: rgba(9, 10, 15, 0.6);
		color: #fff;
		padding: 0.65rem 0.9rem;
		font-size: 0.95rem;
	}

	textarea {
		resize: vertical;
	}

	.form-error {
		color: #f87171;
		font-size: 0.85rem;
	}

	.cards-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
		gap: 1rem;
	}

	.summary-card {
		background: rgba(255, 255, 255, 0.03);
		border-radius: 16px;
		padding: 1rem;
		border: 1px solid rgba(255, 255, 255, 0.05);
	}

	.summary-card small {
		display: block;
		color: rgba(255, 255, 255, 0.6);
		margin-bottom: 0.4rem;
	}

	.summary-card strong {
		font-size: 1.6rem;
	}

	[data-guarded] {
		position: relative;
		transition: filter 0.3s ease, opacity 0.3s ease;
	}

	[data-guarded][data-locked='true'] {
		filter: blur(1px) grayscale(0.4);
		pointer-events: none;
	}

	[data-guarded][data-locked='true']::after {
		content: 'Faça login para acessar estas funções';
		position: absolute;
		inset: 0;
		display: grid;
		place-items: center;
		font-weight: 600;
		letter-spacing: 0.03em;
		background: rgba(5, 6, 10, 0.78);
		border-radius: 24px;
		text-align: center;
		padding: 2rem;
		z-index: 3;
	}

	.data-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
		gap: 1.5rem;
	}

	.table-wrapper {
		margin-top: 1rem;
		border-radius: 16px;
		overflow: hidden;
		border: 1px solid rgba(255, 255, 255, 0.06);
	}

	table {
		width: 100%;
		border-collapse: collapse;
		font-size: 0.9rem;
	}

	thead {
		background: rgba(255, 255, 255, 0.04);
	}

	td,
	th {
		padding: 0.8rem;
		border-bottom: 1px solid rgba(255, 255, 255, 0.04);
	}

	.movement-list {
		list-style: none;
		margin: 1rem 0 0;
		padding: 0;
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
	}

	.movement-item {
		padding: 1rem;
		border-radius: 14px;
		background: rgba(255, 255, 255, 0.03);
		border: 1px solid rgba(255, 255, 255, 0.05);
	}

	.movement-item span {
		display: block;
		font-size: 0.85rem;
		color: rgba(255, 255, 255, 0.65);
		margin: 0.2rem 0;
	}

	.movement-item p {
		margin: 0;
		color: rgba(255, 255, 255, 0.85);
	}

	.movement-list .empty {
		text-align: center;
		padding: 1.5rem;
		background: rgba(255, 255, 255, 0.02);
		border-radius: 14px;
	}

	body:not(.is-auth) #logout-button {
		pointer-events: none;
		opacity: 0.4;
	}

	body.is-auth [data-section='login'] {
		display: none;
	}

	body:not(.is-auth) [data-section='app'] {
		display: none;
	}

	#app-toast {
		position: fixed;
		bottom: 20px;
		right: 24px;
		background: rgba(15, 23, 42, 0.95);
		padding: 0.8rem 1.2rem;
		border-radius: 999px;
		border: 1px solid rgba(255, 255, 255, 0.08);
		transform: translateY(120%);
		opacity: 0;
		transition: transform 0.3s ease, opacity 0.3s ease;
	}

	#app-toast.visible {
		transform: translateY(0);
		opacity: 1;
	}

	#app-toast[data-type='error'] {
		background: rgba(239, 68, 68, 0.9);
	}

	@media (max-width: 860px) {
		.app-header {
			flex-direction: column;
		}
		.inline {
			flex-direction: column;
		}
	}
</style>
